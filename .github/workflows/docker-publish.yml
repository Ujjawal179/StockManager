name: Build and Push Docker Image

on:
  push:
    branches:
      - main  # Adjust this if your main branch has a different name

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # Step 1: Checkout your repository code
    - name: Checkout code
      uses: actions/checkout@v2

    # Step 2: Set up Docker Buildx
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v1

    # Step 3: Log in to DockerHub using your secrets
    - name: Log in to Docker Hub
      uses: docker/login-action@v1
      with:
        username: ${{ secrets.DOCKER_USERNAME }}   # DockerHub username from secrets
        password: ${{ secrets.DOCKER_PASSWORD }}   # DockerHub password from secrets

    # Step 4: Build and push the Docker image
    - name: Build and push Docker image
      uses: docker/build-push-action@v2
      with:
        context: .                                # Context is the current directory
        file: ./Dockerfile                        # Dockerfile path
        push: true                                # Push the image to DockerHub
        tags: ujjawal179/stock-manager:latest     # Your DockerHub username and image tag

    # Step 5: Optional - Print Docker image digest
    - name: Docker image digest
      run: echo "The Docker image was built and pushed with digest ${{ steps.docker_build.outputs.digest }}"
